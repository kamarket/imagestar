<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Service Call</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 2rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.6rem;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    .message {
      margin-top: 1rem;
      color: green;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    .download-buttons {
      display: none;
      margin-top: 1.5rem;
      gap: 1rem;
    }
    .admin-login {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.9rem;
    }
    .admin-login a {
      cursor: pointer;
      color: #007bff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Submit a Service Call</h2>
    <form id="serviceForm">
      <label for="name">Name</label>
      <input type="text" id="name" required>

      <label for="contact">Contact Info</label>
      <input type="text" id="contact" required>

      <label for="modelno">Model no</label>
      <input type="text" id="modelno" required>

      <label for="issue">Issue Description</label>
      <textarea id="issue" rows="4" required></textarea>

      <label for="time">Preferred Time</label>
      <input type="text" id="time">

      <button type="submit">Submit</button>
      <div class="message" id="message"></div>
    </form>

    <div class="admin-login">
      <a onclick="promptAdmin()">üîê Admin Login</a>
    </div>

    <div class="download-buttons" id="adminPanel">
      <button onclick="downloadJSON()">Download JSON</button>
      <button onclick="downloadCSV()">Download CSV</button>
    </div>

    <h3>Submitted Service Calls</h3>
    <table id="callsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Issue</th>
          <th>Preferred Time</th>
          <th>Submitted At</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const form = document.getElementById("serviceForm");
    const message = document.getElementById("message");
    const tableBody = document.querySelector("#callsTable tbody");
    const adminPanel = document.getElementById("adminPanel");

    function loadCalls() {
      tableBody.innerHTML = "";
      const calls = JSON.parse(localStorage.getItem("serviceCalls") || "[]");
      calls.forEach(call => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${call.name}</td>
          <td>${call.issue}</td>
          <td>${call.time}</td>
          <td>${new Date(call.submittedAt).toLocaleString()}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    form.addEventListener("submit", function(event) {
      event.preventDefault();
      const newCall = {
        name: document.getElementById("name").value,
        contact: document.getElementById("contact").value, // Still saved
        issue: document.getElementById("issue").value,
        time: document.getElementById("time").value,
        submittedAt: new Date().toISOString()
      };

      const existing = JSON.parse(localStorage.getItem("serviceCalls") || "[]");
      existing.push(newCall);
      localStorage.setItem("serviceCalls", JSON.stringify(existing));

      message.textContent = "Service call submitted successfully!";
      form.reset();
      loadCalls();
    });

    function downloadJSON() {
      const allCalls = JSON.parse(localStorage.getItem("serviceCalls") || "[]");
      const sanitized = allCalls.map(({ name, issue, time, submittedAt }) => ({ name, issue, time, submittedAt }));
      const blob = new Blob([JSON.stringify(sanitized, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "service_calls.json";
      a.click();
    }

    function downloadCSV() {
      const allCalls = JSON.parse(localStorage.getItem("serviceCalls") || "[]");
      const header = ["Name", "Issue", "Preferred Time", "Submitted At"];
      const rows = allCalls.map(c => [c.name, c.issue, c.time, c.submittedAt]);
      const csv = [header, ...rows].map(r => r.map(field => `"${field}"`).join(",")).join("\n");

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "service_calls.csv";
      a.click();
    }

    function promptAdmin() {
      const password = prompt("Enter admin password:");
      if (password === "admin123") {
        adminPanel.style.display = "flex";
      } else {
        alert("Incorrect password.");
      }
    }

    // Load calls on page load
    loadCalls();
  </script>
</body>
</html>

